(function(){function e(e,n,t){o("([a-zA-Z0-9_\\."+d.scopeGlue+"\\|]+)\\s*([<>=!]+)\\s*([\\\"\\'].*?[\\\"\\']|\\d+|true|false)","g",n,function(e){var r=e[1].trim().split("|");if(r.length>1){var o=a(r[0],t),i=v.filter(r[1],o);n=i+" "+e[2]+" "+e[3]}else{var o=l(a(r[0],t));n=o+" "+e[2]+" "+e[3]}});var r=n;switch(e){case"if":r=e+"( "+n+" ){";break;case"elseif":r="}else if("+n+"){";break;case"else":r="}"+e+"{";break;case"endif":r="}";break;case"/if":r="}"}return r}function n(e,n,t,r){var a=new Date,o=a.getTime()*t.length;return p.dataExtractions[e][o]=t,r.replace(n,e+"_"+o)}function t(e,n){if(null==typeof e||"undefined"==typeof e)for(var t in p.dataExtractions)n=n.replace(e+"_"+t,p.dataExtractions[e][t]),delete p.dataExtractions[e][t];else for(var t in p.dataExtractions[e])n=n.replace(e+"_"+t,p.dataExtractions[e][t]),delete p.dataExtractions[e][t];return n}function r(e,n){return e=e.replace(/[\r\t\n]/g,""),e=v.parseComments(e),e=v.noParse(e),e=v.parseConditional(e,n),e=v.parseVariables(e,n,!0),e=t("noparse",e)}function a(e,n){if("[]"==e)return n;if(-1===e.indexOf(d.scopeGlue))var t=e.split(".");else var t=e.split(d.scopeGlue);if(!(t.length>1))return n[t[0]];for(var r=0;r<t.length;r++)return v.isObject(n)&&n[t[r]].hasOwnProperty(t[r+1])?a(t[r+1],n[t[r]]):n[t[r]];return n}function o(e,n,t,r){for(var a,n=n||"",o=new RegExp(e,n);a=o.exec(t);){var i=r(a,t);"number"==typeof i&&(o.lastIndex=i)}}function s(){if(!d.setupRegex){var e=d.scopeGlue;d.varRegex="\\."===e?"[a-zA-Z0-9_"+e+"]+":"[a-zA-Z0-9_\\."+e+"]+",d.noParseRegex="\\{\\{\\s*noparse\\s*\\}\\}([\\s\\S]*?)\\{\\{\\s*/noparse\\s*\\}\\}",d.varTagRegex="\\{\\{\\s*(.*?)\\s*\\}\\}",d.loopRegex="\\{\\{\\s*("+d.varRegex+")\\s*\\}\\}([\\s\\S]*?)\\{\\{\\s*/\\1\\s*\\}\\}",d.conditionalRegex="\\{\\{\\s*(if|elseif|else|endif|\\/if)\\s*((?:\\()?([\\s\\S]*?)(?:\\))?)\\s*\\}\\}",d.blockRegex="\\{\\{\\s*((?!noparse)"+d.varRegex+")\\s*\\}\\}([\\s\\S]*?)\\{\\{\\s*/\\1\\s*\\}\\}",d.setupRegex=!0}}function u(e,n){e=e||{};for(var t in n)e[t]="object"==typeof n[t]?v.extend(e[t],n[t]):n[t];return e}function l(e){return null===e?"null":e===!0?!0:e===!1?!1:"string"==typeof e?'"'+e.replace(/\\"\\'/g,"\\$&")+'"':"number"==typeof e?e:e}function c(e){e.method=e.method?e.method:"GET";var n=new g;n.onreadystatechange=function(){4==n.readyState&&e.onComplete(200==n.status?n:n)},n.open(e.method,e.url),n.send(null)}function f(e){var n=new g;n.open("GET",e,!1);try{n.send(null)}catch(t){return null}return 404==n.status||2==n.status||0==n.status&&""==n.responseText?null:n.responseText}function g(){for(var e=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],n=0;n<e.length;n++)try{var t=e[n]();if(null!=t)return t}catch(r){continue}}var p=this;p.dataExtractions={noparse:{},loop:{}},p.data=[];var d={debug:!0,setupRegex:!1,scopeGlue:"\\.",varRegex:"",noParseRegex:"",varTagRegex:"",loopRegex:"",conditionalRegex:"",blockRegex:""},m={safe:function(){if(0!=arguments.length){if("string"!=typeof arguments[0])throw new Error("Invalid arguments type");return arguments[0].toString().split("&").join("&").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;").split("'").join("&#039;")}},index:function(){if(0!=arguments.length){if(2==arguments.length&&v.isArray(arguments[1]))return arguments[1][0];if(!v.isArray(arguments[2]))throw new Error("invalid arguments type");return arguments[2][arguments[0]][arguments[1]]}},length:function(){return 0!=arguments.length?v.isObject(arguments[0])?Object.keys(arguments[0]).length:arguments[0].length:void 0}},v=function(e){return e instanceof v?e:this instanceof v?void 0:new v(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=v),exports.gamon=v):p.gamon=v,"function"==typeof define&&define.amd&&define("gmaon",[],function(){return v}),v.scopeGlue=function(e){return"undefined"!==e&&(d.setupRegex=!1,d.scopeGlue=e),d.scopeGlue},v.parse=function(e,n){s();var t,a=document.getElementById(e);return null!==a&&"undefined"!=typeof a?(t=a.innerHTML,t=r(t,n)):t=r(e,n),t},v.parseComments=function(e){return s(),e.replace(/\{\{#.*?#\}\}/g,"")},v.noParse=function(e){return s(),o(d.noParseRegex,"gm",e,function(t){e=n("noparse",t[0],t[1],e)}),e},v.parseConditional=function(t,r){s(),o(d.blockRegex,"gm",t,function(e){t=n("loop",e[0],e[0],t)});var a=0,i="var data = obj; var r=[];";return t=t.replace(/("|')/g,function(e){return'"'==e?'"':"'"==e?"\\'":""}),o(d.conditionalRegex,"gm",t,function(n){var s,u=n[2],l=t.slice(a,n.index);i+="\nr.push('"+l.replace(/("|')/g,function(e){return'"'==e?'"':"'"==e?"'":""})+"');\n",o("([a-zA-Z0-9_\\.\\|"+d.scopeGlue+']+)\\s*([<>=!]+)\\s*(\\".*?\\"|true|false|\\d+)',"g",n[0],function(){u=u.replace(/\b(or|OR|and|AND)\b/g,function(e){var n={or:"||",and:"&&"};return n[e.toLowerCase()]||""})}),s=e(n[1],u,r),i+=s.replace(/("|')/g,function(e){return'"'==e?'"':"'"==e?"'":""}),a=n.index+n[0].length}),i+="\nr.push('"+t.slice(a,t.length)+"');\n",i+="\nreturn r.join('');",i=i.replace(/[\r\t\n]/g,""),new Function("obj",i).apply(r,[r])},v.parseVariables=function(e,n,r){return s(),r&&(e=t("loop",e)),o(d.loopRegex,"gm",e,function(t){var r=a(t[1],n),o="";for(i in r){var s=v.parseConditional(t[2],r[i]);s=v.parseVariables(s,r[i],!0),o+=s}e=e.replace(new RegExp("\\{\\{\\s*("+t[1]+")\\s*\\}\\}([\\s\\S]*?)\\{\\{\\s*(/"+t[1]+")\\s*\\}\\}",""),o)}),o(d.varTagRegex,"g",e,function(t){var r=t[1].split("|");if(r.length>1)var o=a(r[0],n),i=v.filter(r[1],o);else var i=a(t[1],n);e=e.replace(t[0],i)}),e},v.filter=function(e,n){var t=[],r=e;return o("([\\w]+)(\\(.*?\\))","g",e,function(e){o("(\\B[\"'].*?[\"'])|(\\d)","g",e[2],function(e){t.push(e[0].replace(/("|')/g,function(){return""}))}),r=e[1]}),t.push(n),m[r].apply(this,t)},v.filter.register=function(){if(0==arguments.length)throw new Error("Register filter needs an object or filter's name and callback function");if(v.isObject(arguments[0]))for(var e in arguments[0]){var n={};if(n[e]=arguments[0][e],e in m)throw new Error('Filter "'+e+'" already exist!');u(m,n)}else{if("string"!=typeof arguments[0]||!arguments[0].length)throw new Error("Invalid filter register arguments");if("function"!=typeof arguments[1])throw new Error("Filter needs a callback function");var n={};n[arguments[0]]=arguments[1],u(m,n)}},v.loadTemplate=function(e,n){var e=v.isObject(e)?e:{url:e};return n?c(e):f(e.url)},v.log=function(e,n){d.debug&&console[1===e?"log":2===e?"warn":"error"](n)},v.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},v.isObject=function(e){var n=typeof e;return"function"===n||"object"===n&&!!e},v.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===toString.call(e)},v.isNull=function(e){return null===e},v.isUndefined=function(e){return void 0===e}}).call(this);